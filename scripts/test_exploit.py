from pwn import *

context.terminal = ['tmux', 'splitw', '-h']
context.arch = 'amd64'

# テスト用バイナリをコンパイル
import subprocess, tempfile, os

src = r"""
#include <stdio.h>
#include <string.h>

void vuln() {
    char buf[32];
    printf("Input: ");
    gets(buf);
    printf("You said: %s\n", buf);
}

int main() {
    vuln();
    return 0;
}
"""

with open('/tmp/vuln.c', 'w') as f:
    f.write(src)
os.system('gcc -fno-stack-protector -no-pie -o /tmp/vuln /tmp/vuln.c')

# gdb.debug() で起動 → tmux分割でpwndbgが開く
p = gdb.debug('/tmp/vuln', gdbscript='''
b vuln
c
''')

# ブレークで止まったらペイロードを送る
payload = b'A' * 40 + b'BBBBBBBB'
p.sendline(payload)

p.interactive()
